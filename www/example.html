<?xml version="1.0" encoding="utf-8" ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="generator" content="Docutils 0.5: http://docutils.sourceforge.net/" />
<title>Example Usage</title>
<style type="text/css">

/*
:Author: David Goodger (goodger@python.org)
:Id: $Id: html4css1.css 5196 2007-06-03 20:25:28Z wiemann $
:Copyright: This stylesheet has been placed in the public domain.

Default cascading style sheet for the HTML output of Docutils.

See http://docutils.sf.net/docs/howto/html-stylesheets.html for how to
customize this style sheet.
*/

/* used to remove borders from tables and images */
.borderless, table.borderless td, table.borderless th {
  border: 0 }

table.borderless td, table.borderless th {
  /* Override padding for "table.docutils td" with "! important".
     The right padding separates the table cells. */
  padding: 0 0.5em 0 0 ! important }

.first {
  /* Override more specific margin styles with "! important". */
  margin-top: 0 ! important }

.last, .with-subtitle {
  margin-bottom: 0 ! important }

.hidden {
  display: none }

a.toc-backref {
  text-decoration: none ;
  color: black }

blockquote.epigraph {
  margin: 2em 5em ; }

dl.docutils dd {
  margin-bottom: 0.5em }

/* Uncomment (and remove this text!) to get bold-faced definition list terms
dl.docutils dt {
  font-weight: bold }
*/

div.abstract {
  margin: 2em 5em }

div.abstract p.topic-title {
  font-weight: bold ;
  text-align: center }

div.admonition, div.attention, div.caution, div.danger, div.error,
div.hint, div.important, div.note, div.tip, div.warning {
  margin: 2em ;
  border: medium outset ;
  padding: 1em }

div.admonition p.admonition-title, div.hint p.admonition-title,
div.important p.admonition-title, div.note p.admonition-title,
div.tip p.admonition-title {
  font-weight: bold ;
  font-family: sans-serif }

div.attention p.admonition-title, div.caution p.admonition-title,
div.danger p.admonition-title, div.error p.admonition-title,
div.warning p.admonition-title {
  color: red ;
  font-weight: bold ;
  font-family: sans-serif }

/* Uncomment (and remove this text!) to get reduced vertical space in
   compound paragraphs.
div.compound .compound-first, div.compound .compound-middle {
  margin-bottom: 0.5em }

div.compound .compound-last, div.compound .compound-middle {
  margin-top: 0.5em }
*/

div.dedication {
  margin: 2em 5em ;
  text-align: center ;
  font-style: italic }

div.dedication p.topic-title {
  font-weight: bold ;
  font-style: normal }

div.figure {
  margin-left: 2em ;
  margin-right: 2em }

div.footer, div.header {
  clear: both;
  font-size: smaller }

div.line-block {
  display: block ;
  margin-top: 1em ;
  margin-bottom: 1em }

div.line-block div.line-block {
  margin-top: 0 ;
  margin-bottom: 0 ;
  margin-left: 1.5em }

div.sidebar {
  margin: 0 0 0.5em 1em ;
  border: medium outset ;
  padding: 1em ;
  background-color: #ffffee ;
  width: 40% ;
  float: right ;
  clear: right }

div.sidebar p.rubric {
  font-family: sans-serif ;
  font-size: medium }

div.system-messages {
  margin: 5em }

div.system-messages h1 {
  color: red }

div.system-message {
  border: medium outset ;
  padding: 1em }

div.system-message p.system-message-title {
  color: red ;
  font-weight: bold }

div.topic {
  margin: 2em }

h1.section-subtitle, h2.section-subtitle, h3.section-subtitle,
h4.section-subtitle, h5.section-subtitle, h6.section-subtitle {
  margin-top: 0.4em }

h1.title {
  text-align: center }

h2.subtitle {
  text-align: center }

hr.docutils {
  width: 75% }

img.align-left {
  clear: left }

img.align-right {
  clear: right }

ol.simple, ul.simple {
  margin-bottom: 1em }

ol.arabic {
  list-style: decimal }

ol.loweralpha {
  list-style: lower-alpha }

ol.upperalpha {
  list-style: upper-alpha }

ol.lowerroman {
  list-style: lower-roman }

ol.upperroman {
  list-style: upper-roman }

p.attribution {
  text-align: right ;
  margin-left: 50% }

p.caption {
  font-style: italic }

p.credits {
  font-style: italic ;
  font-size: smaller }

p.label {
  white-space: nowrap }

p.rubric {
  font-weight: bold ;
  font-size: larger ;
  color: maroon ;
  text-align: center }

p.sidebar-title {
  font-family: sans-serif ;
  font-weight: bold ;
  font-size: larger }

p.sidebar-subtitle {
  font-family: sans-serif ;
  font-weight: bold }

p.topic-title {
  font-weight: bold }

pre.address {
  margin-bottom: 0 ;
  margin-top: 0 ;
  font-family: serif ;
  font-size: 100% }

pre.literal-block, pre.doctest-block {
  margin-left: 2em ;
  margin-right: 2em }

span.classifier {
  font-family: sans-serif ;
  font-style: oblique }

span.classifier-delimiter {
  font-family: sans-serif ;
  font-weight: bold }

span.interpreted {
  font-family: sans-serif }

span.option {
  white-space: nowrap }

span.pre {
  white-space: pre }

span.problematic {
  color: red }

span.section-subtitle {
  /* font-size relative to parent (h1..h6 element) */
  font-size: 80% }

table.citation {
  border-left: solid 1px gray;
  margin-left: 1px }

table.docinfo {
  margin: 2em 4em }

table.docutils {
  margin-top: 0.5em ;
  margin-bottom: 0.5em }

table.footnote {
  border-left: solid 1px black;
  margin-left: 1px }

table.docutils td, table.docutils th,
table.docinfo td, table.docinfo th {
  padding-left: 0.5em ;
  padding-right: 0.5em ;
  vertical-align: top }

table.docutils th.field-name, table.docinfo th.docinfo-name {
  font-weight: bold ;
  text-align: left ;
  white-space: nowrap ;
  padding-left: 0 }

h1 tt.docutils, h2 tt.docutils, h3 tt.docutils,
h4 tt.docutils, h5 tt.docutils, h6 tt.docutils {
  font-size: 100% }

ul.auto-toc {
  list-style-type: none }

</style>
</head>
<body><script src="https://ssl.google-analytics.com/urchin.js" type="text/javascript"></script><script type="text/javascript">_uacct = "UA-1070906-4";urchinTracker();</script>
<div class="document" id="example-usage">
<h1 class="title">Example Usage</h1>

<p>The first step in building an application which uses ActiveObjects is to define the
entities.  This is done in pure Java (no XML configuration).  The entity definitions are
database non-specific:</p>
<pre class="literal-block">
// Person.java
public interface Person extends Entity {
    public String getName();
    public void setName(String name);

    public int getAge();
    public void setAge(int age);

    &#64;SQLType(Types.CLOB)
    public String getComment();

    &#64;SQLType(Types.CLOB)
    public void setComment(String comment);

    public Family getFamily();
    public void setFamily();

    &#64;ManyToMany(PersonToPerson.class)
    public Person[] getPeople();
}

// Family.java
public interface Family extends Entity {
    public String getName();
    public void setName(String name);

    &#64;OneToMany
    public Person[] getPeople();
}

// PersonToPerson.java
public interface PersonToPerson extends Entity {
    public Person getPersonA();
    public void setPersonA(Person person);

    public Person getPersonB();
    public void setPersonB(Person person);
}
</pre>
<p>Once we have the entity definitions, the DDL statements can be auto-generated for
whatever database you may be using.  This is done using migrations. Here's what the
DDL would look like as generated for the MySQL database:</p>
<pre class="literal-block">
CREATE TABLE family (
    id INTEGER NOT NULL AUTO_INCREMENT,
    name VARCHAR(255),
    PRIMARY KEY (id)
) ENGINE=InnoDB;

CREATE TABLE person (
    id INTEGER NOT NULL AUTO_INCREMENT,
    name VARCHAR(255),
    age INTEGER,
    comment TEXT,
    familyID INTEGER,
    PRIMARY KEY (id),
    CONSTRAINT fk_person_familyID FOREIGN KEY (familyID) REFERENCES family(id)
) ENGINE=InnoDB;

CREATE TABLE personToPerson (
    id INTEGER NOT NULL AUTO_INCREMENT,
    personAID INTEGER,
    personBID INTEGER,
    PRIMARY KEY (id),
    CONSTRAINT fk_personToPerson_personAID FOREIGN KEY (personAID) REFERENCES person (id),
    CONSTRAINT fk_personToPerson_personBID FOREIGN KEY (personBID) REFERENCES person (id)
) ENGINE=InnoDB;
</pre>
<p>You'll notice the usage of convention to determine field names, primary and foreign keys,
etc...</p>
<p>Of course, an ORM layer isn't very useful unless you actually <em>use</em> it.  Here's some
sample code showing some basic CRUD operations with our new model:</p>
<pre class="literal-block">
// ...

// retrieves an EntityManager relevant to the specified URI
// if available (i.e. the classpath set appropriately), the connection will be pooled
EntityManager manager = new EntityManager(&quot;jdbc:mysql://localhost/ao_test&quot;, &quot;user&quot;, &quot;password&quot;);

Family family = manager.create(Family.class);
family.setName(&quot;Spiewak&quot;);
family.save();

Person me = manager.create(Person.class);
me.setName(&quot;Daniel Spiewak&quot;);
me.setAge(27);
me.setComment(&quot;I love databasing&quot;);
me.setFamily(family);
me.save();

Person you = manager.create(Person.class);
you.setName(&quot;Joe Blow&quot;);
you.setAge(23);
you.setComment(&quot;Guess who?&quot;);
you.setFamily(family);
you.save();

PersonToPerson relation = manager.create(PersonToPerson.class);
relation.setPersonA(me);
relation.setPersonB(you);
relation.save();

family.getPeople();         // ...returns new Person[] {you, me}
you.getPeople();            // ...returns new Person[] {me}

/*
 * notice, this is the first use of SQL in the whole example, and
 * it's a contrived usage at that
 */
Family[] families = manager.findWithSQL(Family.class, &quot;familyID&quot;, &quot;SELECT DISTINCT familyID FROM person&quot;);

// returns any person with age greater than or equal to 18
Person[] overAge = manager.find(Person.class, &quot;age &gt;= ?&quot;, 18);

/*
 * notice the varargs parameters, as well as the direct use of an
 * entity instance without worrying about the ID value
 */
Person[] inFamilyOver21 = manager.find(Person.class, &quot;age &gt;= ? AND familyID = ?&quot;, 21, family);
</pre>
<p>As you see, much of the framework is designed to completely encapsulate
the developer from the complexities of SQL and even from the precise specifics
of the schema.  The only place where this rule is broken is in the <tt class="docutils literal"><span class="pre">find</span></tt>
methods, which are designed to leverage the full power of SQL, rather than
completely shelter the developer.</p>
</div>
</body>
</html>
