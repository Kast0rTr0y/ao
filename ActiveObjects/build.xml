<?xml version="1.0" encoding="UTF-8"?>

<project name="ActiveObjects" default="build">
	<property file="build.properties"/>
	
	<target name="init">
		<mkdir dir="bin"/>
	</target>
	
	<target name="init-dist">
		<mkdir dir="dist/activeobjects-${activeobjects.version}/lib"/>
		<mkdir dir="dist/activeobjects-${activeobjects.version}/src"/>
		<mkdir dir="dist/activeobjects-${activeobjects.version}/doc"/>
	</target>
	
	<target name="init-doc" unless="supress-doc-deletion">
		<delete>
			<fileset dir="${javadoc.path}">
				<include name="**/*"/>
			</fileset>
		</delete>
	</target>
	
	<target name="build" depends="init">
		<javac srcdir="src" destdir="bin" classpath="${build.classpath}" source="1.5" target="1.5" debug="${build.debug}"/>
	</target>
	
	<target name="assign-doc-dir" unless="javadoc.intern.path">
		<property name="javadoc.intern.path" value="${javadoc.path}"/>
	</target>
	
	<target name="doc" depends="init-doc,assign-doc-dir">
		<javadoc sourcepath="src" classpath="${build.classpath}" destdir="${javadoc.intern.path}"
		 		windowtitle="ActiveObjects: Javadoc" private="no" protected="yes">
			<packageset dir="src">
				<include name="net/java/ao/**/*.java"/>
			</packageset>
		</javadoc>
	</target>
	
	<target name="jar" depends="build">
		<copy file="${commons-cli.path}" todir="dist/activeobjects-${activeobjects.version}/lib"/>
		
		<jar basedir="bin" compress="${jar.compress}" 
				destfile="dist/activeobjects-${activeobjects.version}/activeobjects-${activeobjects.version}.jar">
			<manifest>
				<attribute name="Class-Path" value="lib/commons-cli-1.0.jar"/>
				<attribute name="Main-Class" value="net.java.ao.schema.Generator"/>
			</manifest>
		</jar>
	</target>
	
	<target name="dist" depends="jar">
		<property name="javadoc.intern.path" value="dist/activeobjects-${activeobjects.version}/doc"/>
		<property name="supress-doc-deletion" value="yes"/>
		<antcall target="doc"/>
		
		<copy todir="dist/activeobjects-${activeobjects.version}/src">
			<fileset dir="src">
				<include name="**/*.java"/>
			</fileset>
		</copy>
		<copy todir="dist/activeobjects-${activeobjects.version}">
			<fileset dir=".">
				<include name="LICENSE"/>
			</fileset>
		</copy>
		
		<zip destfile="dist/activeobjects-${activeobjects.version}.zip">
			<fileset id="productDir" dir="dist">
				<include name="activeobjects-${activeobjects.version}/**/*"/>
			</fileset>
		</zip>
		
		<tar destfile="dist/activeobjects-${activeobjects.version}.tar">
			<fileset refid="productDir"/>
		</tar>
		<gzip src="dist/activeobjects-${activeobjects.version}.tar" zipfile="dist/activeobjects-${activeobjects.version}.tar.gz"/>
		<delete file="dist/activeobjects-${activeobjects.version}.tar"/>
		
		<delete includeemptydirs="yes">
			<fileset dir="dist">
				<include name="activeobjects-${activeobjects.version}/**/*"/>
			</fileset>
		</delete>
		<delete includeemptydirs="yes">
			<fileset dir="dist">
				<include name="activeobjects-${activeobjects.version}"/>
			</fileset>
		</delete>
	</target>
	
	<target name="clean">
		<delete dir="bin"/>
	</target>
	
	<target name="clean-dist">
		<delete dir="dist"/>
	</target>
</project>